<app-navbar></app-navbar>

<main class="container mx-auto p-4 md:p-6">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
    <h1 class="text-2xl md:text-3xl font-bold text-slate-800">
      Dashboard
    </h1>
    <a routerLink="/orders/new"
       class="mt-4 md:mt-0 px-5 py-2.5 font-semibold text-white bg-teal-500 rounded-lg hover:bg-teal-600 transition-colors shadow-sm hover:shadow-md">
      + Buat Order Baru
    </a>
  </div>

  <h2 class="text-xl font-semibold text-slate-700 mb-4 border-b pb-2">Order Aktif Saat Ini</h2>

  <div class="space-y-4">
    <ng-container *ngIf="activeOrders$ | async as orders; else loading">
      <div *ngIf="orders.length > 0; else noOrders" class="grid gap-5 md:grid-cols-2 lg:grid-cols-3">

        <a *ngFor="let order of orders" [routerLink]="['/orders', order.id]"
           class="block p-5 bg-white rounded-xl border border-slate-200 hover:border-teal-400 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group">

          <h3 class="text-lg font-bold text-slate-800 group-hover:text-teal-600 truncate transition-colors">{{ order.title }}</h3>
          <p class="text-sm text-slate-500 mt-1">PIC: {{ order.profiles?.full_name || 'Tidak diketahui' }}</p>

          <div class="mt-4 flex justify-between items-center">
            <span class="text-sm font-medium text-slate-600 bg-slate-100 px-2 py-1 rounded-md">{{ order.participant_orders?.length || 0 }} Peserta</span>
            <span class="text-xs text-amber-800 font-semibold bg-amber-100 px-2 py-1 rounded-full">{{ order.deadline | date:'short' }}</span>
          </div>
        </a>

      </div>

      <ng-template #noOrders>
        <div class="text-center py-12 px-6 bg-slate-50 rounded-xl border-dashed border-2 border-slate-200">
          <p class="text-slate-500 text-lg">ðŸŽ‰ Saat ini tidak ada order aktif.</p>
          <p class="text-slate-400">Waktunya membuat yang baru!</p>
        </div>
      </ng-template>
    </ng-container>

    <ng-template #loading>
      <div class="text-center py-10">
        <p class="text-slate-500">Memuat data order...</p>
      </div>
    </ng-template>
  </div>

  <hr class="my-8">

  <h2 class="text-xl font-semibold text-slate-700 mb-4">Riwayat Order</h2>
  <div class="space-y-4">
    <ng-container *ngIf="closedOrders$ | async as orders; else loadingHistory">
      <div *ngIf="orders.length > 0; else noHistory" class="grid gap-5 md:grid-cols-2 lg:grid-cols-3">

        <a *ngFor="let order of orders" [routerLink]="['/orders', order.id]"
          class="block p-5 bg-white rounded-xl border border-slate-200 hover:border-slate-400 hover:shadow-lg transition-all duration-300 group opacity-80 hover:opacity-100">

          <div class="flex justify-between items-center">
              <h3 class="text-lg font-bold text-slate-700 truncate">{{ order.title }}</h3>
              <span *ngIf="order.status === 'CLOSED'" class="text-xs font-semibold text-blue-800 bg-blue-100 px-2 py-1 rounded-full">Selesai</span>
              <span *ngIf="order.status === 'CANCELED'" class="text-xs font-semibold text-rose-800 bg-rose-100 px-2 py-1 rounded-full">Batal</span>
          </div>

          <p class="text-sm text-slate-500 mt-1">
            PIC: <span class="font-medium">{{ order.profiles?.full_name || 'Tidak diketahui' }}</span>
          </p>

          <div class="mt-4 flex justify-between items-center">
            <span class="text-sm font-medium text-slate-600 bg-slate-100 px-2 py-1 rounded-md">
              {{ order.participant_orders?.length || 0 }} Peserta
            </span>
            <span class="text-xs text-slate-500 font-semibold">{{ order.deadline | date:'shortDate' }}</span>
          </div>
        </a>

      </div>
      <ng-template #noHistory>
        <div class="text-center py-10 px-6 bg-slate-50 rounded-xl">
          <p class="text-slate-500">Anda belum memiliki riwayat order.</p>
        </div>
      </ng-template>
    </ng-container>
    <ng-template #loadingHistory>
      <div class="text-center py-10">
        <p class="text-slate-500">Memuat riwayat order...</p>
      </div>
    </ng-template>
  </div>
</main>
